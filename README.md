# üìä Ecommerce Performancce & Conversion Analysis | SQL, BigQuery

**Author:** Hoang Duc Kien

**Date:** 2025

**Tools Used:** SQL, BigQuery

## üìë Table of Contents

- [üìå Background & Overview](#-background--overview)
- [üìÇ Dataset Description & Data Structure](#-dataset-description--data-structure)
- [‚öíÔ∏è Main Analysis Process](#Ô∏è-main-analysis-process)
- [üîé Final Insights & Recommendations](#-final-insights--recommendations)

## üìå Background & Overview

### üìñ What is this project about?

This project analyzes user traffic and purchasing behavior of an e-commerce website using SQL in BigQuery.

The objective is to evaluate:

- ‚úîÔ∏è Traffic growth trends
- ‚úîÔ∏è Conversion efficiency
- ‚úîÔ∏è User purchasing patterns
- ‚úîÔ∏è Marketing channel effectiveness

The analysis focuses on understanding how users move through the purchase funnel and identifying optimization opportunities to increase revenue.

### üë§ Target Audience

- ‚úîÔ∏è Data Analysts & Business Analysts
- ‚úîÔ∏è Digital Marketing Teams
- ‚úîÔ∏è E-commerce Managers & Stakeholders
- ‚úîÔ∏è Business Intelligence Teams

## üìÇ Dataset Description & Data Structure

**üìå Data Source:**  
Public Google Analytics dataset stored in BigQuery.

**üìå Dataset Used:**  
`bigquery-public-data.google_analytics_sample`

**üìå Key Tables:**

- `ga_sessions_2017*`

**üìå Key Fields Used:**

- `fullVisitorId`
- `date`
- `totals`
- `totals.bounces`
- `totals.hits`
- `totals.pageviews`
- `totals.visits`
- `totals.transactions`
- `trafficSource.source`
- `hits`
- `hits.eCommerceAction`
- `hits.eCommerceAction.action_type`
- `hits.product`
- `hits.product.productQuantity`
- `hits.product.productRevenue`
- `hits.product.productSKU`
- `hits.product.v2ProductName`

## ‚öíÔ∏è Main Analysis Process

### üîç Query 01: Calculate total visit, pageview, transaction for Jan, Feb and March 2017 (order by month)

#### üöÄ Query

This analysis focuses on calculating the total number of visits, pageviews, and transactions for January, February, and March 2017. The results are organized by month to provide a clear comparison of website performance across the first quarter. This helps identify overall trends and changes in user activity during this period.

```sql
SELECT
  FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS month,
  SUM(totals.visits) AS visits,
  SUM(totals.pageviews) AS pageviews,
  SUM(totals.transactions) AS transactions
FROM `bigquery-public-data.google_analytics_sample.ga_sessions_2017*`
WHERE _table_suffix BETWEEN '0101' AND '0331'
GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
ORDER BY month;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/0f8ba7a7-103c-49cd-9665-03e77023869f)

### üîç Query 02: Calculate bounce rate per traffic source in July 2017

This analysis aims to calculate the bounce rate for each traffic source in July 2017. By comparing bounce rates across different sources, we can evaluate the quality of incoming traffic and identify which channels drive more engaged users to the website.

#### üöÄ Query

```sql
With raw_data AS(
  SELECT
    trafficSource.source as source,
    SUM(totals.visits) as total_visits,
    SUM(totals.bounces) as total_no_of_bounces
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`
  GROUP BY trafficSource.source
  ORDER BY total_visits DESC
)

SELECT
  source,
  total_visits,
  total_no_of_bounces,
  ROUND((total_no_of_bounces/total_visits)*100,3) AS bounce_rate
FROM raw_data;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/13ce2c78-ac51-4651-a70f-0a01e18a2fe5)

### üîç Query 03: Calculate revenue by traffic source by week, by month in June 2017

This analysis calculates revenue generated by each traffic source in June 2017, broken down by week and by month. By comparing revenue over different time periods, it helps evaluate which channels perform consistently and which ones fluctuate, providing insights for marketing budget allocation and performance optimization.

#### üöÄ Query

```sql
WITH revenue_week AS(
  SELECT
    'Week' as time_type,
    FORMAT_DATE('%G%V', PARSE_DATE('%Y%m%d', date)) AS time,
    trafficSource.source,
    SUM(productRevenue/1000000) as revenue
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201706*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE productRevenue IS NOT NULL
  GROUP BY FORMAT_DATE('%G%V', PARSE_DATE('%Y%m%d', date)),trafficSource.source
),
revenue_month AS(
    SELECT
    'Month' as time_type,
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS time,
    trafficSource.source,
    SUM(productRevenue/1000000) as revenue
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201706*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE productRevenue IS NOT NULL
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)),trafficSource.source
)

SELECT
  time_type,
  time,
  source,
  ROUND(revenue,4)
FROM(
  SELECT * FROM revenue_week
  UNION ALL
  SELECT * FROM revenue_month
)
ORDER BY revenue DESC;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/13a5d587-0c5e-4638-b08b-0a0acd1e2b79)

### üîç Query 04: Calculate average number of pageviews by purchaser type (purchasers vs non-purchasers) in June, July 2017

This analysis calculates the average number of pageviews for purchasers and non-purchasers in June and July 2017. By comparing these two groups, we can better understand differences in user engagement and identify whether higher browsing activity is associated with a greater likelihood of making a purchase.

#### üöÄ Query

```sql
WITH purchase_data AS(
  SELECT
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS month,
    SUM(totals.pageviews) AS total_pageviews,
    COUNT (DISTINCT fullVisitorId) AS number_unique_user
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_2017*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    _table_suffix between '0601' and '0731'AND
    totals.transactions >= 1 AND
    productRevenue IS NOT NULL
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
),
non_purchase_data AS(
  SELECT
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS month,
    SUM(totals.pageviews) AS total_pageviews,
    COUNT (DISTINCT fullVisitorId) AS number_unique_user
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_2017*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    _table_suffix between '0601' and '0731'and
    totals.transactions IS NULL AND
    productRevenue IS NULL
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
)

SELECT
  p.month,
  ROUND(p.total_pageviews/p.number_unique_user,8) AS avg_pageviews_purchase,
  ROUND(n.total_pageviews/n.number_unique_user,7) AS avg_pageviews_non_purchase
FROM purchase_data AS p
INNER JOIN non_purchase_data AS n
ON p.month = n.month
ORDER BY month;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/aa12fe09-f4f0-4b21-baa7-635e03ddce1d)

### üîç Query 05: Calculate average number of transactions per user that made a purchase in July 2017

This analysis calculates the average number of transactions per purchasing user in July 2017. It helps evaluate buying frequency among customers and provides insight into repeat purchase behavior and overall customer loyalty.

#### üöÄ Query

```sql
WITH purchase_tran_data AS(
  SELECT
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS Month,
    SUM(totals.transactions) AS total_transactions,
    COUNT (DISTINCT fullVisitorId) AS number_unique_user
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    totals.transactions >= 1 AND
    productRevenue IS NOT NULL
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
)

SELECT
  Month,
  ROUND(total_transactions/number_unique_user,9) AS Avg_total_transactions_per_user
FROM purchase_tran_data;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/aa12fe09-f4f0-4b21-baa7-635e03ddce1d)

### üîç Query 06: Calculate average amount of money spent per session. Only include purchaser data in July 2017

This analysis calculates the average amount of money spent per session among users who made a purchase in July 2017. By focusing only on purchasing sessions, it provides a clearer view of customer spending behavior and helps assess the overall revenue value generated per visit.

#### üöÄ Query

```sql
WITH amount_money_per_session AS(
  SELECT
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) AS Month,
    SUM(totals.visits) AS total_visits,
    SUM(productRevenue)/1000000 AS total_revenue
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    totals.transactions >= 1 AND
    productRevenue IS NOT NULL
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
)

SELECT
  Month,
  ROUND(total_revenue/total_visits,2) AS avg_revenue_by_user_per_visit
FROM amount_money_per_session;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/d3a5a385-5946-41b9-b9b0-a0edb5053e82)

### üîç Query 07: Other products purchased by customers who purchased product "YouTube Men's Vintage Henley" in July 2017

This analysis identifies other products purchased by customers who bought the "YouTube Men's Vintage Henley" in July 2017. By examining additional items bought by the same users, it helps uncover cross-selling opportunities and better understand customer product preferences.

#### üöÄ Query

```sql
WITH list_customer AS(
  SELECT
    fullVisitorId,
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    eCommerceAction.action_type = '6'AND
    v2ProductName = "YouTube Men's Vintage Henley"
)
SELECT
  v2ProductName AS other_purchased_products,
  SUM(productQuantity) AS quantity
FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`,
UNNEST(hits)hits,
UNNEST(hits.product)
WHERE
  totals.transactions >= 1 AND
  productRevenue IS NOT NULL AND
  fullVisitorId IN (SELECT fullVisitorId FROM list_customer) AND
  v2ProductName <> "YouTube Men's Vintage Henley"
GROUP BY v2ProductName
ORDER BY quantity DESC;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/d3a5a385-5946-41b9-b9b0-a0edb5053e82)

### üîç Query 08: Calculate cohort map from product view to addtocart to purchase in Jan, Feb and March 2017

This analysis builds a cohort funnel from product view to add-to-cart and purchase for January, February, and March 2017. By tracking user progression through each stage of the conversion process, it helps evaluate drop-off rates and identify changes in purchasing behavior across the first quarter.

#### üöÄ Query

```sql
WITH raw_data AS(
  SELECT
    FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date)) as month,
    SUM(CASE WHEN eCommerceAction.action_type = "2" THEN 1 ELSE 0 END) AS num_product_view,
    SUM(CASE WHEN eCommerceAction.action_type = "3" THEN 1 ELSE 0 END) AS num_addtocart,
    SUM(CASE WHEN eCommerceAction.action_type = "6" AND  productRevenue IS NOT NULL THEN 1 ELSE 0 END) AS num_purchase
  FROM `bigquery-public-data.google_analytics_sample.ga_sessions_2017*`,
  UNNEST(hits)hits,
  UNNEST(hits.product)
  WHERE
    _table_suffix between '0101' and '0331'
  GROUP BY FORMAT_DATE('%Y%m',PARSE_DATE('%Y%m%d', date))
)
SELECT
  month,
  num_product_view,
  num_addtocart,
  num_purchase,
  ROUND((num_addtocart/num_product_view)*100,2) AS add_to_cart_rate,
  ROUND((num_purchase/num_product_view)*100,2) AS purchase_rate
FROM raw_data
ORDER BY month;
```

#### üí° Result

![Image](https://github.com/user-attachments/assets/21de9e06-6446-4c36-8d0e-044d2f395e6c)

## üîé Final Insights & Recommendations

### üìå Insights

- Website performance improved across Q1, with March recording the highest transactions and purchase rate, indicating a stronger conversion funnel over time.

- Direct traffic generated the highest revenue with a relatively lower bounce rate, while YouTube and Facebook showed high bounce rates, suggesting lower traffic quality.

- Non-purchasers viewed significantly more pages on average than purchasers, implying that heavy browsing does not necessarily lead to conversion.

- Purchasing users demonstrated strong buying behavior, averaging over 4 transactions per user and around $43.85 per session, with clear cross-selling patterns among related products.

### üìå Recommendations

- Further optimize the conversion funnel, especially from product view to add-to-cart and purchase, by applying successful strategies observed in March.

- Reallocate marketing budget toward high-performing channels such as direct and Google traffic, while improving landing page relevance for social and referral sources to reduce bounce rate.

- Enhance UX/UI and call-to-action strategies to shorten the purchase journey and convert high-browsing users through personalization and retargeting campaigns.

- Strengthen retention and cross-selling strategies through bundle offers, loyalty programs, and ‚Äúfrequently bought together‚Äù recommendations to maximize customer lifetime value.
